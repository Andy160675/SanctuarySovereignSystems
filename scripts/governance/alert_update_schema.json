{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://aegis/alert-update.schema.json",
  "title": "Aegis Alert Update",
  "description": "Canonical schema for system-wide Alert Updates (feedback propagation after a validated fix).",
  "type": "object",
  "additionalProperties": false,
  "properties": {
    "alert_id": { "type": "string", "pattern": "^[A-Z0-9_-]{8,64}$" },
    "incident_id": { "type": "string" },
    "observed_at_gemba": { "type": "string", "description": "What was observed at point of work (concise)" },
    "boundary": { "type": "string", "description": "Boundary/guard/rule name involved" },
    "change": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "type": { "type": "string", "enum": ["rule_update", "guard_patch", "constraint_change", "policy_update", "config_change"] },
        "summary": { "type": "string" },
        "details": { "type": "object" }
      },
      "required": ["type", "summary"]
    },
    "effective_ts": { "type": "string", "pattern": "^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(?:\\.\\d+)?Z$" },
    "required_local_actions": { "type": "array", "items": { "type": "string" } },
    "origin_node": { "type": "string" },
    "version": { "type": "string", "default": "1" }
  },
  "required": ["alert_id", "incident_id", "observed_at_gemba", "boundary", "change", "effective_ts", "origin_node"]
}
